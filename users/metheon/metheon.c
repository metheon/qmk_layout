#include "metheon.h"

#if defined(COMBO_ENABLE)
#include "g/keymap_combo.h" // to make combo def dictionary work
#endif

layer_state_t layer_state_set_user(layer_state_t state) {
    state = update_tri_layer_state(state, _FUNPAD, _MAGNET, _SECRETS);
    state = update_tri_layer_state(state, _LOWER, _RAISE, _ADJUST);
    return state;
};

bool get_tapping_force_hold(uint16_t keycode, keyrecord_t *record) {
    switch (keycode) {
        case HOME_A:
        case HOME_R:
        case HOME_S:
        case HOME_T:
        case HOME_N:
        case HOME_E:
        case HOME_I:
        case HOME_O:
            return true;
        default:
            return false;
    }
}

uint16_t get_tapping_term(uint16_t keycode, keyrecord_t *record) {
    switch (keycode) {
        case HOME_A:
        case HOME_R:
        case HOME_S:
        case HOME_T:
        case HOME_N:
        case HOME_E:
        case HOME_I:
        case HOME_O:
            return TAPPING_TERM - 100; // 400-100=300
        case THMB_L1:
        case THMB_L2:
        case THMB_L3:
        case THMB_R1:
        case THMB_R2:
        case THMB_R3:
            return TAPPING_TERM - 225; // 400-225=175
        default:
            return TAPPING_TERM;       // 400
    }
}

void matrix_scan_user(void) {
    matrix_scan_encoders();
    matrix_scan_window_tab();
}

// clang-format off
const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
    [_BASE] = LAYOUT_metheon(
    //  .--------+--------+--------+--------+--------+--------.                                     .--------+--------+--------+--------+--------+--------.
         __NONE__,KC_Q    ,KC_W    ,KC_F    ,KC_P    ,KC_B    ,                                      KC_J    ,KC_L    ,KC_U    ,KC_Y    ,KC_QUOT ,__NONE__,
    //  |--------+--------+--------+--------+--------+--------|                                     |--------+--------+--------+--------+--------+--------|
         __NONE__,HOME_A  ,HOME_R  ,HOME_S  ,HOME_T  ,KC_G    ,                                      KC_M    ,HOME_N  ,HOME_E  ,HOME_I  ,HOME_O  ,__NONE__,
    //  |--------+--------+--------+--------+--------+--------+--------+--------. .--------+--------+--------+--------+--------+--------+--------+--------|
         __NONE__,KC_Z    ,KC_X    ,KC_C    ,KC_D    ,KC_V    ,__NONE__,__NONE__,  __NONE__,__NONE__,KC_K    ,KC_H    ,KC_COMMA,KC_DOT  ,KC_SLSH ,__NONE__,
    //  '--------+--------+--------+--------+--------+--------+--------+--------| |--------+--------+--------+--------+--------+--------+--------+--------'
                                    __NONE__,__NONE__,THMB_L1 ,THMB_L2 ,THMB_L3 ,  THMB_R3 ,THMB_R2 ,THMB_R1 ,__NONE__,__NONE__ 
    //                             '--------+--------+--------+--------+--------' '--------+--------+--------+--------+--------'
    ),
    [_LOWER] = LAYOUT_metheon( // add funpad to this layer, combos for 12 as , and ,. as . mayby others?
    //  .--------+--------+--------+--------+--------+--------.                                     .--------+--------+--------+--------+--------+--------.
         __NONE__,KC_SLSH ,KC_ASTR ,KC_MINS ,KC_PLUS ,KC_EQL  ,                                      KC_PERC ,KC_7    ,KC_8    ,KC_9    ,__NONE__,__NONE__,
    //  |--------+--------+--------+--------+--------+--------|                                     |--------+--------+--------+--------+--------+--------|
         __NONE__,KC_LGUI ,KC_LALT ,KC_LSFT ,KC_LCTRL,KC_LPRN ,                                      KC_RPRN ,KC_4    ,KC_5    ,KC_6    ,KC_0    ,__NONE__,
    //  |--------+--------+--------+--------+--------+--------+--------+--------. .--------+--------+--------+--------+--------+--------+--------+--------|
         __NONE__,__NONE__,KC_COMMA,KC_DOT  ,__NONE__,LOCK    ,__NONE__,__NONE__,  __NONE__,__NONE__,__NONE__,KC_1    ,KC_2    ,KC_3    ,__NONE__,__NONE__,
    //  '--------+--------+--------+--------+--------+--------+--------+--------| |--------+--------+--------+--------+--------+--------+--------+--------'
                                    ________,________,________,THMB_R2 ,________,  ________,THMB_R2 ,________,________,________
    //                             '--------+--------+--------+--------+--------' '--------+--------+--------+--------+--------'
    ),
    [_RAISE] = LAYOUT_metheon(
    //  .--------+--------+--------+--------+--------+--------.                                     .--------+--------+--------+--------+--------+--------.
         __NONE__,KC_GRV  ,KC_CIRC ,KC_HASH ,KC_TILD ,KC_LCBR ,                                      KC_RCBR ,KC_DLR  ,KC_EUR  ,KC_PND  ,__NONE__,__NONE__,
    //  |--------+--------+--------+--------+--------+--------|                                     |--------+--------+--------+--------+--------+--------|
         __NONE__,KC_AT   ,KC_AE   ,KC_OE   ,KC_AA   ,KC_LPRN ,                                      KC_RPRN ,KC_EQL  ,KC_EXLM ,KC_AMPR ,KC_PIPE ,__NONE__,
    //  |--------+--------+--------+--------+--------+--------+--------+--------. .--------+--------+--------+--------+--------+--------+--------+--------|
         __NONE__,KC_BSLS ,KC_PERC ,KC_UNDS ,KC_MINS ,KC_LBRC ,__NONE__,__NONE__,  __NONE__,__NONE__,KC_RBRC ,KC_COLN ,KC_SCLN ,__NONE__,__NONE__,__NONE__,
    //  '--------+--------+--------+--------+--------+--------+--------+--------| |--------+--------+--------+--------+--------+--------+--------+--------'
                                    ________,________,________,THMB_L2 ,________,  ________,THMB_L2 ,________,________,________
    //                             '--------+--------+--------+--------+--------' '--------+--------+--------+--------+--------'
    ),
    [_EXTEND] = LAYOUT_metheon(
    //  .--------+--------+--------+--------+--------+--------.                                     .--------+--------+--------+--------+--------+--------.
         __NONE__,PREV_TAB,NEXT_TAB,PREV_WIN,NEXT_WIN,__NONE__,                                      KC_PGUP ,KC_HOME ,KC_UP   ,KC_END  ,KC_DEL  ,__NONE__,
    //  |--------+--------+--------+--------+--------+--------|                                     |--------+--------+--------+--------+--------+--------|
         __NONE__,KC_LGUI ,KC_LALT ,KC_LSFT ,KC_LCTRL,SEARCH  ,                                      KC_PGDN ,KC_LEFT ,KC_DOWN ,KC_RGHT ,KC_ENTER,__NONE__,
    //  |--------+--------+--------+--------+--------+--------+--------+--------. .--------+--------+--------+--------+--------+--------+--------+--------|
         __NONE__,LOCK    ,SEARCH  ,KC_STAB ,KC_TAB  ,__NONE__,__NONE__,__NONE__,  __NONE__,__NONE__,__NONE__,KC_BSPC ,KC_DEL  ,__NONE__,__NONE__,__NONE__,
    //  '--------+--------+--------+--------+--------+--------+--------+--------| |--------+--------+--------+--------+--------+--------+--------+--------'
                                    ________,________,________,________,________,  ________,________,________,________,________
    //                             '--------+--------+--------+--------+--------' '--------+--------+--------+--------+--------'
    ),
    [_FUNPAD] = LAYOUT_metheon(
    //  .--------+--------+--------+--------+--------+--------.                                     .--------+--------+--------+--------+--------+--------.
         __NONE__,__NONE__,__NONE__,__NONE__,__NONE__,__NONE__,                                      __NONE__,KC_F7   ,KC_F8   ,KC_F9   ,KC_F12  ,__NONE__,
    //  |--------+--------+--------+--------+--------+--------|                                     |--------+--------+--------+--------+--------+--------|
         __NONE__,KC_LGUI ,KC_LALT ,KC_LSFT ,KC_LCTRL,__NONE__,                                      __NONE__,KC_F4   ,KC_F5   ,KC_F6   ,KC_F10  ,__NONE__,
    //  |--------+--------+--------+--------+--------+--------+--------+--------. .--------+--------+--------+--------+--------+--------+--------+--------|
         __NONE__,__NONE__,__NONE__,__NONE__,__NONE__,__NONE__,__NONE__,__NONE__,  __NONE__,__NONE__,__NONE__,KC_F1   ,KC_F2   ,KC_F3   ,KC_F11  ,__NONE__,
    //  '--------+--------+--------+--------+--------+--------+--------+--------| |--------+--------+--------+--------+--------+--------+--------+--------'
                                    ________,________,________,________,________,  ________,________,________,________,________
    //                             '--------+--------+--------+--------+--------' '--------+--------+--------+--------+--------'
    ),
    [_ADJUST] = LAYOUT_metheon(
    //  .--------+--------+--------+--------+--------+--------.                                     .--------+--------+--------+--------+--------+--------.
         __NONE__,RESET   ,__NONE__,WHICH_OS,CG_TOGG ,__NONE__,                                      TO_BL3  ,KC_FLASH,KC_MAKE ,KC_VRSN ,__NONE__,__NONE__,
    //  |--------+--------+--------+--------+--------+--------|                                     |--------+--------+--------+--------+--------+--------|
         __NONE__,KC_CAPS ,KC_MPRV ,KC_MPLY ,KC_MNXT ,__NONE__,                                      RGB_TOG ,RGB_MOD ,RGB_HUI ,RGB_SAI ,RGB_VAI ,__NONE__,
    //  |--------+--------+--------+--------+--------+--------+--------+--------. .--------+--------+--------+--------+--------+--------+--------+--------|
         __NONE__,__NONE__,KC_MUTE ,KC_VOLD ,KC_VOLU ,__NONE__,__NONE__,__NONE__,  __NONE__,__NONE__,__NONE__,RGB_RMOD,RGB_HUD ,RGB_SAD ,RGB_VAD ,__NONE__,
    //  '--------+--------+--------+--------+--------+--------+--------+--------| |--------+--------+--------+--------+--------+--------+--------+--------'
                                    ________,________,________,________,________,  ________,________,________,________,________
    //                             '--------+--------+--------+--------+--------' '--------+--------+--------+--------+--------'
    ),
    [_MAGNET] = LAYOUT_metheon(
    //  .--------+--------+--------+--------+--------+--------.                                     .--------+--------+--------+--------+--------+--------.
         __NONE__,__NONE__,MG_UL_QD,MG_UP_HF,MG_UR_QD,__NONE__,                                      __NONE__,__NONE__,__NONE__,__NONE__,__NONE__,__NONE__,
    //  |--------+--------+--------+--------+--------+--------|                                     |--------+--------+--------+--------+--------+--------|
         __NONE__,__NONE__,MG_LF_HF,MG_FSCR ,MG_RT_HF,__NONE__,                                      ________,MG_LF_TD,MG_MD_TD,MG_RT_TD,__NONE__,__NONE__,
    //  |--------+--------+--------+--------+--------+--------+--------+--------. .--------+--------+--------+--------+--------+--------+--------+--------|
         __NONE__,__NONE__,MG_BL_QD,MG_BT_HF,MG_BR_QD,__NONE__,__NONE__,__NONE__,  __NONE__,__NONE__,__NONE__,MG_L2_TD,MG_R2_TD,__NONE__,__NONE__,__NONE__,
    //  '--------+--------+--------+--------+--------+--------+--------+--------| |--------+--------+--------+--------+--------+--------+--------+--------'
                                    ________,________,________,________,________,  ________,________,________,________,________
    //                             '--------+--------+--------+--------+--------' '--------+--------+--------+--------+--------'
    ),
    [_SECRETS] = LAYOUT_metheon(
    //  .--------+--------+--------+--------+--------+--------.                                     .--------+--------+--------+--------+--------+--------.
         __NONE__,SECRET00,SECRET01,SECRET02,SECRET03,SECRET04,                                      SECRET05,SECRET06,SECRET07,SECRET08,SECRET09,__NONE__,
    //  |--------+--------+--------+--------+--------+--------|                                     |--------+--------+--------+--------+--------+--------|
         __NONE__,SECRET10,SECRET11,SECRET12,SECRET13,SECRET14,                                      SECRET15,SECRET16,SECRET17,SECRET18,SECRET19,__NONE__,
    //  |--------+--------+--------+--------+--------+--------+--------+--------. .--------+--------+--------+--------+--------+--------+--------+--------|
         __NONE__,__NONE__,__NONE__,__NONE__,__NONE__,__NONE__,__NONE__,__NONE__,  __NONE__,__NONE__,__NONE__,__NONE__,__NONE__,__NONE__,__NONE__,__NONE__,
    //  '--------+--------+--------+--------+--------+--------+--------+--------| |--------+--------+--------+--------+--------+--------+--------+--------'
                                    ________,________,________,________,________,  ________,________,________,________,________
    //                             '--------+--------+--------+--------+--------' '--------+--------+--------+--------+--------'
    ),
    [_BL3_BSE] = LAYOUT_metheon(
    //  .--------+--------+--------+--------+--------+--------.                                     .--------+--------+--------+--------+--------+--------.
         __NONE__,KC_F    ,KC_Q    ,BL3_W   ,KC_E    ,KC_R    ,                                      __NONE__,__NONE__,__NONE__,__NONE__,__NONE__,__NONE__,
    //  |--------+--------+--------+--------+--------+--------|                                     |--------+--------+--------+--------+--------+--------|
         __NONE__,KC_LCTL ,BL3_A   ,BL3_S   ,BL3_D   ,KC_G    ,                                      __NONE__,__NONE__,__NONE__,__NONE__,__NONE__,__NONE__,
    //  |--------+--------+--------+--------+--------+--------+--------+--------. .--------+--------+--------+--------+--------+--------+--------+--------|
         __NONE__,KC_LSFT ,KC_1    ,KC_2    ,KC_3    ,KC_4    ,__NONE__,__NONE__,  __NONE__,__NONE__,__NONE__,__NONE__,__NONE__,__NONE__,__NONE__,__NONE__,
    //  '--------+--------+--------+--------+--------+--------+--------+--------| |--------+--------+--------+--------+--------+--------+--------+--------'
                                    ________,________,KC_V    ,BL3_SPC ,________,  ________,________,________,________,________
    //                             '--------+--------+--------+--------+--------' '--------+--------+--------+--------+--------'
    ),
    [_BL3_UPR] = LAYOUT_metheon(
    //  .--------+--------+--------+--------+--------+--------.                                     .--------+--------+--------+--------+--------+--------.
         __NONE__,KC_TAB  ,KC_LBRC ,________,KC_RBRC ,KC_C    ,                                      __NONE__,__NONE__,__NONE__,__NONE__,__NONE__,__NONE__,
    //  |--------+--------+--------+--------+--------+--------|                                     |--------+--------+--------+--------+--------+--------|
         __NONE__,KC_ESC  ,________,________,________,KC_X    ,                                      __NONE__,__NONE__,__NONE__,__NONE__,__NONE__,__NONE__,
    //  |--------+--------+--------+--------+--------+--------+--------+--------. .--------+--------+--------+--------+--------+--------+--------+--------|
         __NONE__,________,KC_M    ,KC_I    ,KC_L    ,KC_K    ,__NONE__,TO_BASE ,  __NONE__,__NONE__,__NONE__,__NONE__,__NONE__,__NONE__,__NONE__,__NONE__,
    //  '--------+--------+--------+--------+--------+--------+--------+--------| |--------+--------+--------+--------+--------+--------+--------+--------'
                                    ________,________,________,________,________,  ________,________,________,________,________
    //                             '--------+--------+--------+--------+--------' '--------+--------+--------+--------+--------'
    )
};
// clang-format on

